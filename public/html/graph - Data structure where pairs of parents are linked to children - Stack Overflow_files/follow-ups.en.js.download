(()=>{"use strict";var e={p:""};e.p=document.getElementById("webpack-public-path").innerText+"Js/",(()=>{function e(e,t,o=void 0,a=void 0){const n=new FormData;n.append("fKey",null!=a?a:StackExchange.options.user.fkey),n.append("data",JSON.stringify(t)),n.append("event",e);let s={};o&&(s["X-Previous-Event-Id"]=o),fetch((StackExchange.options.site.routePrefix||"")+"/stackevent",{method:"POST",keepalive:!0,body:n,headers:s}).then((()=>{}))}const t=600,o=(e,t)=>{e.querySelectorAll(t.join(", ")).forEach((e=>{e.classList.toggle("d-none")}))},a=e=>{var t;if(e&&!e.classList.contains("d-none"))null===(t=e.querySelector("textarea"))||void 0===t||t.focus();else{const t=e.querySelector("textarea");t&&(t.value="")}};async function n(t,o,a){var n;t.preventDefault();const r=o.getAttribute("data-post-id"),l=o.querySelector(".js-add-comment-submit");null==l||l.classList.add("is-loading");let c,d=!1;const i=parseInt((null===(n=document.querySelector(".js-question"))||void 0===n?void 0:n.getAttribute("data-questionid"))||"0"),u=parseInt(r||"0"),p=parseInt(o.getAttribute("data-total-comment-count")||"0"),m=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(o);try{const e=new FormData;e.append("comment",a.value),e.append("fkey",StackExchange.options.user.fkey);const t=await fetch(`/posts/${r}/comments`,{method:"POST",body:e});if(!t.ok){const e=await t.text()||__tr(["An error occurred while attempting to submit your comment"], undefined, "en", []);throw new Error(e)}{d=!0;const e=await t.text(),a=new DOMParser,n=a.parseFromString(e,"text/html").querySelectorAll(".js-comment");c=parseInt(n[n.length-1].getAttribute("data-comment-id")||"0"),await s(o,{topCommentsOnly:!1,scrollToContainerEnd:!0})}}catch(e){null==l||l.classList.remove("is-loading");let t=__tr(["An error occurred during edit submit."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger"})}e("follow_ups_ui_experiment.comment.submit",{source:window.location.href,submitSuccess:d,questionId:i,answerId:u,commentId:c,numberOfPreExistingComments:p,answerPositionOnPage:m,followUpsUIExperimentGroup:"test"})}async function s(e,t={}){var o;if(e){const a=null!==(o=null==t?void 0:t.topCommentsOnly)&&void 0!==o?o:"True"===e.getAttribute("data-top-comments-only"),n=e.getAttribute("data-post-id"),s=await fetch(`/posts/${n}/follow-ups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topCommentsOnly:a,includeDeleted:!!t.includeDeleted})}),r=await s.text(),l=e.parentElement;if(l){l.innerHTML=r;const e=l.firstElementChild;e&&m([e]),t.scrollToContainerEnd&&setTimeout((()=>{window.scrollTo({top:Math.round(l.getBoundingClientRect().height+document.documentElement.scrollTop),behavior:"smooth"})}),0)}}}const r=e=>{const o=e.querySelector(".js-comment-text-input"),a=e.querySelector(".js-char-counter"),n=e.querySelector(".js-add-comment-submit, .js-edit-comment-submit");o&&a&&n&&(null==o||o.addEventListener("input",(e=>((e,o,a)=>{const n=e.target.value.length;let s="";o.classList.remove("fc-red-400","supernova"),n<15?(s=0===n?"Enter at least 15 characters":15-n+" more to go...",a.disabled=!0):n>t?(s=`Too long by ${n-t} characters`,o.classList.add("fc-red-400"),a.disabled=!0):(a.disabled=!1,t-n<=50&&(s=t-n+" characters left",o.classList.add("supernova"))),""!==s?(o.textContent=s,o.style.display="inline"):o.style.display="none"})(e,a,n))))},l=e=>{e.querySelectorAll(".js-follow-up-delete").forEach((t=>t.addEventListener("click",(o=>(async(e,t,o)=>{e.preventDefault();const a=o.closest(".js-follow-up"),n=null==a?void 0:a.getAttribute("data-follow-up-id"),r=new FormData;r.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{const e=await fetch(`/posts/comments/${n}/vote/10`,{method:"POST",body:r});if(!e.ok){const t=await e.text()||__tr(["An error occurred while attempting to delete your comment"], undefined, "en", []);throw new Error(t)}await s(t,{topCommentsOnly:!1,includeDeleted:!0})}catch(e){o.classList.remove("is-loading"),StackExchange.helpers.showToast(__tr(["An error occurred while attempting to delete your comment"], undefined, "en", []),{type:"danger"})}})(o,e,t)))))},c=e=>{e.querySelectorAll(".js-follow-up-undelete").forEach((t=>t.addEventListener("click",(o=>(async(e,t,o)=>{e.preventDefault();const a=t.getAttribute("data-post-id"),n=o.closest(".js-follow-up"),r=null==n?void 0:n.getAttribute("data-follow-up-id"),l=new FormData;l.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{(new FormData).append("fkey",StackExchange.options.user.fkey);const e=await fetch(`/admin/posts/${a}/comments/${r}/undelete`,{method:"POST",body:l});if(!e.ok){const t=await e.text()||__tr(["An error occurred while attempting to undelete your comment"], undefined, "en", []);throw new Error(t)}await s(t)}catch(e){o.classList.remove("is-loading"),StackExchange.helpers.showToast(__tr(["An error occurred while attempting to undelete your comment"], undefined, "en", []),{type:"danger"})}})(o,e,t)))))},d=t=>{t.querySelectorAll(".js-vote-button").forEach((o=>{o.classList.contains("is-disabled")?o.addEventListener("click",(a=>{var n,s;a.preventDefault();const r=parseInt((null===(n=document.querySelector(".js-question"))||void 0===n?void 0:n.getAttribute("data-questionid"))||"0"),l=parseInt(t.getAttribute("data-post-id")||"0"),c=parseInt((null===(s=o.closest(".js-follow-up"))||void 0===s?void 0:s.getAttribute("data-follow-up-id"))||"0");e("follow_ups_ui_experiment.vote_attempt",{source:window.location.href,questionId:r,answerId:l,commentId:c,followUpsUIExperimentGroup:"test"})})):o.addEventListener("click",(e=>(async(e,t,o)=>{e.preventDefault();const a=t.getAttribute("data-post-id"),n=o.closest(".js-follow-up"),r=null==n?void 0:n.getAttribute("data-follow-up-id"),l=o.classList.contains("bc-orange-400")?0:2,c=new FormData;c.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{const e=await fetch(`/posts/comments/${r}/vote/${l}`,{method:"POST",body:c});if(!e.ok)throw new Error;const t=await e.json();if(!t.Success)throw new Error(t.Message);const o=document.querySelector(`.js-follow-ups-container[data-post-id="${a}"]`);await s(o)}catch(e){o.classList.remove("is-loading");let t=__tr(["An error occurred during voting."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger",useRawHtml:!0})}})(e,t,o)))}))},i=e=>{e.querySelectorAll("button.js-follow-up-edit, button.js-edit-comment-cancel").forEach((e=>{const t=e.closest(".js-follow-up");t&&e.addEventListener("click",(()=>{e.classList.contains("js-follow-up-edit")&&(r(t),(e=>{var t;const o=e.querySelector(".js-comment-text-input"),a=e.querySelector(".js-comment-body");o&&a&&(o.value=(null===(t=a.textContent)||void 0===t?void 0:t.trim())||"",o.dispatchEvent(new Event("input")))})(t)),o(t,[".js-toggle-for-edit",".edit-comment-form"]),a(t.querySelector(".edit-comment-form"))}))}));e.querySelectorAll("button.js-edit-comment-submit").forEach((t=>{const o=t.closest(".js-follow-up");if(!o)return;const a=o.querySelector(".js-comment-text-input"),n=o.getAttribute("data-follow-up-id");t.addEventListener("click",(t=>async function(e,t,o,a){var n,r;e.preventDefault();const l=t.querySelector(`.js-follow-up[data-follow-up-id="${o}"]`),c=null===(r=null===(n=l.querySelector(".js-comment-body"))||void 0===n?void 0:n.textContent)||void 0===r?void 0:r.trim();if(c&&a.value.trim()===c)return void StackExchange.helpers.showToast(__tr(["No changes were made to the comment!"], undefined, "en", []),{type:"danger"});const d=l.querySelector(".js-edit-comment-submit");null==d||d.classList.add("is-loading");const i=new FormData;i.append("fkey",StackExchange.options.user.fkey),i.append("comment",a.value);try{const e=await fetch(`/posts/comments/${o}/edit`,{method:"POST",body:i});if(!e.ok){const t=await e.text()||__tr(["An error occurred during edit submit."], undefined, "en", []);throw new Error(t)}await s(t)}catch(e){null==d||d.classList.remove("is-loading");let t=__tr(["An error occurred during edit submit."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger",useRawHtml:!0})}}(t,e,n,a)))}))},u=e=>document.querySelector(`div[data-follow-up-id="${e}"]`),p=(e,t=!1)=>{e.classList.add("comment__highlight"),t&&e.scrollIntoView({behavior:"smooth",block:"center"})},m=e=>{(null!=e?e:document.querySelectorAll(".js-follow-ups-container")).forEach((e=>{(e=>{e.querySelectorAll("button.js-reply-bar, button.js-add-comment-cancel").forEach((t=>{t.addEventListener("click",(()=>{o(e,[".js-reply-bar",".add-comment-form"]),a(e.querySelector(".add-comment-form"))}))}))})(e),r(e),(e=>{e.querySelectorAll(".js-follow-up").forEach((e=>{const t=e.querySelector(".js-flag-button");t&&(e.addEventListener("mouseenter",(()=>{t.classList.remove("d-none")})),e.addEventListener("mouseleave",(()=>{t.classList.add("d-none")})))}))})(e),(e=>{const t=e.querySelector(".js-add-comment-submit"),o=e.querySelector(".js-comment-text-input");t&&o&&(t.addEventListener("click",(t=>n(t,e,o))),o.addEventListener("keydown",(t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),n(t,e,o))})))})(e),l(e),c(e),d(e),(e=>{const t=e.getAttribute("data-post-id"),o=e.getAttribute("data-comment-flags-remaining-today");e.querySelectorAll(".js-flag-button").forEach((e=>{const a=e.getAttribute("data-follow-up-id");e.addEventListener("click",(()=>{dispatchEvent(new CustomEvent("flagButtonClick",{detail:{postId:t,followUpId:a,commentFlagsRemainingToday:o}}))}))}))})(e),(e=>{const t=e.getAttribute("data-post-id");e.querySelectorAll(".js-flag-retract-button").forEach((e=>{const o=e.getAttribute("data-follow-up-id");e.addEventListener("click",(()=>{dispatchEvent(new CustomEvent("flagButtonClick",{detail:{postId:t,followUpId:o,retracting:!0}}))}))}))})(e),i(e),(e=>{const t=e.querySelectorAll(".js-follow-up-copy-link"),o=e.getAttribute("data-post-id");t.forEach((e=>{e.addEventListener("click",(async t=>{t.preventDefault();const a=e.closest(".js-follow-up"),n=null==a?void 0:a.getAttribute("data-follow-up-id"),s=`${window.location.origin}${window.location.pathname}#comment${n}_${o}`;try{await navigator.clipboard.writeText(s),StackExchange.helpers.showToast(__tr(["Link copied to clipboard!"], undefined, "en", []),{type:"success"})}catch{StackExchange.helpers.showToast(__tr(["Failed to copy link to clipboard."], undefined, "en", []),{type:"danger"})}}))}))})(e),(e=>{const t=e.querySelector(".js-full-collapse");t&&t.addEventListener("click",(()=>{e.querySelectorAll(".js-follow-ups, .js-arrow").forEach((e=>{e.classList.toggle("d-none")}))}))})(e),(e=>{const t=e.querySelector(".js-show-more-button");t&&t.addEventListener("click",(async()=>{await s(e,{topCommentsOnly:!1})}))})(e)})),document.querySelectorAll(".js-fetch-deleted-follow-ups").forEach((e=>{const t=e.closest(".js-answer"),o=null==t?void 0:t.querySelector(".js-follow-ups-container");o&&e.addEventListener("click",(async t=>{if(t.preventDefault(),o){const t=e.classList.toggle("showing-deleted");await s(o,{topCommentsOnly:!1,includeDeleted:t})}}),{once:!0})}))};m(),window.addEventListener("flagSubmitted",(async e=>{const{postId:t,followUpId:o,flagReasonSelected:a,otherText:n}=e.detail,r=new FormData;r.append("fkey",StackExchange.options.user.fkey),r.append("otherText",n);try{const e=await fetch(`/flags/comments/${o}/add/${a}`,{method:"POST",body:r});if(!e.ok)throw new Error;const n=await e.json();if(!n.Success)throw new Error(n.Message);const l=document.querySelector(`.js-follow-ups-container[data-post-id="${t}"]`);await s(l),StackExchange.helpers.showToast(__tr(["Thanks for flagging! We take your reports seriously."], undefined, "en", []),{type:"success",transientTimeout:3e3})}catch(e){let t=__tr(["An error occurred during flagging."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger",useRawHtml:!0})}})),window.addEventListener("flagRetract",(async e=>{const{postId:t,followUpId:o,flagReasonSelected:a}=e.detail,n=new FormData;n.append("fkey",StackExchange.options.user.fkey);try{const e=await fetch(`/flags/comments/${o}/retract/${a}`,{method:"POST",body:n});if(!e.ok)throw new Error;const r=await e.json();if(!r.Success)throw new Error(r.Message);const l=document.querySelector(`.js-follow-ups-container[data-post-id="${t}"]`);await s(l),StackExchange.helpers.showToast(__tr(["Your flag has been retracted."], undefined, "en", []),{type:"success",transientTimeout:3e3})}catch(e){let t=__tr(["An error occurred while trying to retract your flag."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger",useRawHtml:!0})}})),StackExchange.ready((()=>{document.querySelectorAll(".js-follow-ups-container").length>0&&(()=>{const e=window.location.hash;if(!e.startsWith("#comment"))return;const[t,o]=e.replace("#comment","").split("_");t&&o&&!isNaN(Number(t))&&!isNaN(Number(o))&&null===document.querySelector(`.js-question[data-questionid="${o}"]`)&&setTimeout((()=>{const e=u(t);if(e)return void p(e);const a=document.querySelector(`.js-follow-ups-container[data-post-id="${o}"]`);a?s(a,{topCommentsOnly:!1}).then((()=>{const e=u(t);e?p(e,!0):StackExchange.helpers.showToast(__tr(["Comment not found."], undefined, "en", []),{type:"danger"})})):StackExchange.helpers.showToast(__tr(["Comment not found."], undefined, "en", []),{type:"danger"})}),300)})()}))})()})();